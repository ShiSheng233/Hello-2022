<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<title>Flag 记录集</title>
		<!-- MDUI CSS -->
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/mdui@1.0.1/dist/css/mdui.min.css"
			integrity="sha384-cLRrMq39HOZdvE0j6yBojO4+1PrHfB7a9l5qLcmRm/fiWXYY+CndJPmyu5FV/9Tw"
			crossorigin="anonymous"
		/>

		<!-- MDUI JavaScript -->
		<script
			src="https://cdn.jsdelivr.net/npm/mdui@1.0.1/dist/js/mdui.min.js"
			integrity="sha384-gCMZcshYKOGRX9r6wbDrvF+TcCCswSHFucUzUPwka+Gr+uHgjlYvkABr95TCOz3A"
			crossorigin="anonymous"
		></script>
	</head>
	<body class="mdui-theme-accent-pink">
		<div class="mdui-container">
			<h1>Flag 记录集</h1>
			<p>Page: <span id="page">?</span></p>

			<div class="mdui-divider mdui-m-t-2 mdui-m-b-2"></div>

			<p>时间：<span id="time">?</span></p>
			<p id="flag">nnd, 跟我玩阴的是吧, 直 接 来 吧 ！</p>

			<div class="mdui-divider mdui-m-t-2 mdui-m-b-2"></div>

			<a class="mdui-btn mdui-btn-raised mdui-color-theme-accent" id="pre">上一页</a>
			<a class="mdui-btn mdui-btn-raised mdui-color-theme-accent mdui-float-right" id="next">下一页</a>
		</div>

		<script>
			var token = null;
			var page = 0;

			function checkPage() {
				if (!token) {
					token = prompt('请输入 Token');
				}

				page = Number(window.location.hash.replace('#', ''));
				if (isNaN(page)) {
					window.location.href = '#1';
					return;
				}

				mdui.$('#page').html(page.toString());
				mdui.$('#time').html((new Date(page * 1000)).toString());

				mdui.$('#pre').prop('href', '#' + (page - 1));
				mdui.$('#next').prop('href', '#' + (page + 1));

				mdui.$.ajax({
					method: 'GET',
					url: '/api/flag',
					data: {
						token: token,
						page: page
					},
					onSuccess: (data) => {
						let json = JSON.parse(data);
						mdui.$('#flag').html(json.flag);
					},
					onError: () => {
						mdui.$('#flag').html('nnd, 跟我玩阴的是吧, 直 接 来 吧 ！');
					}
				});
			}

			window.onhashchange = checkPage;
			checkPage();
		</script>
	</body>
</html>
